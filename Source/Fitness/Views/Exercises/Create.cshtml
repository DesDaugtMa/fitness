@model Fitness.Models.ViewModels.Exercises.Create;

@{
    ViewData["Title"] = "Übung erstellen";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

<style>
    /* --- Basis-Feld: Hintergrund auf reines Weiß setzen --- */
    .choices__inner,
    .choices__input,
    .choices__list--single,
    .choices[data-type*="select-one"] .choices__inner,
    .choices__list--dropdown {
        background-color: #ffffff !important;
        background: #ffffff !important; /* Doppelte Absicherung */
        border-radius: 0.375rem !important;
    }

    /* Fokus-Blau von Bootstrap imitieren */
    .is-focused .choices__inner {
        border-color: #86b7fe !important;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
    }

    /* --- Ausgewählte Items (Tags): Weißer Hintergrund & Dunkles X --- */
    .choices__list--multiple .choices__item {
        font-size: .9rem;
        background-color: #ffffff !important;
        color: #212529 !important;
        border: 1px solid #dee2e6 !important;
        border-radius: 6px !important;
        font-weight: 500;
        margin: 3px 6px 3px 0 !important;
        padding: 4px 10px !important;
        display: inline-flex !important;
        align-items: center;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

        /* Das "X" schwarz färben */
        .choices__list--multiple .choices__item .choices__button {
            border-left: 1px solid #dee2e6 !important;
            margin-left: 8px !important;
            padding-left: 16px !important;
            opacity: 0.6;
            filter: invert(1) grayscale(1) brightness(0) !important; /* Trick für schwarzes Icon */
            background-size: 10px;
        }

    /* --- Mobile-Optimierung: Größere Items für Touch --- */
    @@media (max-width: 768px) {
        .choices__inner {
            padding: 8px 10px !important;
            min-height: 52px !important;
        }

        .choices__list--multiple .choices__item {
            font-size: 20px !important; /* Verhindert iOS-Zoom */
            padding: 8px 15px !important;
            margin: 4px 6px 4px 0 !important;
            border-radius: 8px !important;
        }

            .choices__list--multiple .choices__item .choices__button {
                width: 32px !important;
                height: 100%;
                background-size: 14px;
            }

        .choices__list--dropdown .choices__item {
            padding: 12px 15px !important;
            font-size: 16px !important;
        }
    }
</style>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
                    <form asp-action="Create" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                        <div class="form-group mb-3">
                            <partial name="_ImageUpload" view-data='@new ViewDataDictionary(ViewData) {
                                { "InputName", "ImageFile" },
                                { "UploadHeight", "10rem" },
                                { "UploadWidth", "100%" },
                                { "IsOptional", true }
                            }' />
                        </div>

                        <div class="form-group mb-3">
                            <label asp-for="Name" class="form-label fw-bold"></label><span class="text-danger">*</span>
                            <input asp-for="Name" class="form-control" placeholder="z.B. Bankdrücken" />
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-3">
                            <label asp-for="Description" class="form-label fw-bold"></label> <small class="text-secondary">(optional)</small>
                            <textarea asp-for="Description" class="form-control" rows="4" placeholder="Beschreibe die Ausführung der Übung..."></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-3">
                            <label asp-for="YouTubeLink" class="form-label fw-bold"></label> <small class="text-secondary">(optional)</small>
                            <input asp-for="YouTubeLink" class="form-control" placeholder="https://www.youtube.com/watch?v=..." />
                            <span asp-validation-for="YouTubeLink" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-4">
                            <label asp-for="SelectedMuscleGroupIds" class="form-label fw-bold"></label><span class="text-danger">*</span>
                            <select asp-for="SelectedMuscleGroupIds" asp-items="Model.AvailableMuscleGroups" id="muscle-groups-select" class="form-control" multiple>
                            </select>
                            <span asp-validation-for="SelectedMuscleGroupIds" class="text-danger"></span>
                        </div>

                        <div class="row g-3">
                            <div class="col-6 col-md-4">
                                <a asp-action="Index" class="btn btn-outline-danger w-100">Abbrechen</a>
                            </div>

                            <div class="col-6 col-md-8">
                                <button type="submit" class="btn btn-primary w-100">
                                    Übung hinzufügen
                                </button>
                            </div>
                        </div>
                    </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var element = document.getElementById('muscle-groups-select');

            // Choices.js Initialisierung
            var choices = new Choices(element, {
                removeItemButton: true,
                placeholderValue: 'Muskelgruppen auswählen...',
                searchPlaceholderValue: 'Nach Muskelgruppen suchen...',
                noResultsText: 'Keine Muskelgruppe gefunden',
                itemSelectText: 'Klicken zum Auswählen'
            });
        });
    </script>
}